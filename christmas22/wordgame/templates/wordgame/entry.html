{% extends parent_template|default:"base.html" %}
{% load static %}

{% block content %}
    <div class="card col-md-10 mx-md-auto mb-3 px-0 border-success">
        <h2 class="card-header bg-success text-white">Christmas Word Game</h2>
        <div class="card-row">
            <button class="btn btn-success m-3" type="button"
                    data-bs-toggle="collapse" data-bs-target="#wordgame-rules"
                    aria-expanded="false" aria-controls="wordgame-rules">Rules...</button>
        </div>
        <div class="info-box m-3 h5 collapse" id="wordgame-rules">
            <ol>
                <li>A new Christmas word will appear every day. Make as many new words as you can from the letters of
                    the given Christmas word. For example, if the given word is "Star", the words "rat", "rats", "art",
                    "arts", and "tar" would all count, but not "trap" because the letter 'p' is not in "star;" or "tart"
                    because "star" has only one "t." The word "star" would also not count since it simply repeats the
                    given word.</li>
                <li>All words must be in English, have at least three letters, and not be vulgarities.
                <li>Apostrophes and hyphenated words are not allowed, nor are proper names. (Not even Jim!)
                <li>You may use a dictionary to check your words but the words should come from your own mind and not be
                    generated by any program or device.</li>
                <li>Pressing the "Check and Save" button displays your accepted words and gives the reason any word is
                    rejected. Duplicates of words you previously entered will be not be included.</li>
                <li>You can come back and add more words later in the day, but once the new word appears, 12:00 midnight
                    Michigan time, you will not be able to add words to a previous set.</li>
                <li>Players get one point for each accepted word and an extra point for each accepted word that no one
                    else entered.</li>
                <li>Many perfectly valid words do not appear in the dictionary used for this game. I will monitor this,
                    gradually add them to the dictionary and update the scores accordingly.</li>
                <li>Once you click "Check and Save" your score will begin to appear in the section below the comments.
                    This score is not final since other players may add words that were unique to you before or as words
                    are added to the dictionary. The first player to post words should expect a big drop in score when
                    other players begin to add their words.</li>
                <li>You can see the cumulative scores and lists of all player's entries on the Scoreboard page.</li>
            </ol>
        </div>
        <hr>
        {% if current_word %}
            <h5 class="mx-auto text-success">Use the letters of:</h5>
            <h1 class="mx-auto text-success">{{ current_word }}</h1>
            <form action="{% url 'wordgame:entry' %}" method="post">
                {% csrf_token %}
                <div class="form-group col-md-10 mx-md-auto mt-3 text-success">
                    <label for="new_list">
                        to enter as many new words as you can, separated by commas, in the space below:
                    </label>
                    <textarea class="form-control" id="new_list" name="word_list" rows="1" autofocus>
                    </textarea>
                </div>
                <div class="row justify-content-around">
                    <button class="btn btn-outline-success btn-lg col-md-4"
                            type="submit" name="button" value="check">Check and Save</button>
                </div>
            </form>
        {% elif date_one %}
            <p class="mx-auto text-success px-3 h3">
                Sorry, no words yet, the first one will be ready on {{ date_one|date:"M j, Y" }}.
            </p>
        {% else %}
            <p class="mx-auto text-success px-3 h3">
                Sorry, I've run out of words for this year, but you can make comments below as
                I finalize the scores on the last set of words.
            </p>
        {% endif %}
        {% if player_list %}
            <div class="row justify-content-around mb-3">
                <div class="card col-md-5 text-success border-success pb-2">
                    <h4 class="card-header bg-white px-0">Words Accepted:</h4>
                    {% for word in player_list %}
                        {% if not word.explanation %}
                            {% if forloop.last %}
                                {{ word }}
                            {% else %}
                                {{ word }},
                            {% endif %}
                        {% endif %}
                    {% endfor %}
                </div>
                <div class="card col-md-5 border-success text-success pb-2">
                    <h4 class="card-header px-0 bg-white">Words Currently Rejected:</h4>
                    {% for word in player_list %}
                        {% if word.explanation %}
                            {{ word }} - {{ word.explanation }}<br>
                        {% endif %}
                    {% endfor %}
                </div>
            </div>
        {% endif %}
        {% if comments %}
            {% for comment in comments %}
                {% if comment.player == user %}
                    <p class="comment px-4">
                        {{ comment.player }} says: {{ comment.comment }}
                        <a href="{% url 'wordgame:edit_comment' comment.pk %}"> (Edit...)</a>
                    </p>
                {% else %}
                    <p class="comment px-4">
                        {{ comment.player }} says: {{ comment.comment }}
                    </p>
                {% endif %}
            {% endfor %}
        {% endif %}
        <form action="{% url 'wordgame:entry' %}" method="post">
            {% csrf_token %}
            <div class="form-group col-md-12 mx-md-auto my-3">
                <label for="comment_entry">
                    Add comments here for other players to see:
                </label>
                <textarea class="form-control" id="comment_entry" name="comment" rows="1"></textarea>
                <div class="d-flex justify-content-end">
                    <button class="btn btn-outline-success mt-1 btn-sm" type="submit" name="button" value="comment">
                        Add Comment
                    </button>
                </div>
            </div>
        </form>
        <div class="row mx-3 mb-3 justify-content-center">
            {% if today %}
                <div class="card col-md-6 px-0 h-100">
                    <h3 class="card-header bg-success text-white">Today's Current Scores:</h3>
                    <table class="table text-center text-success">
                        <thead>
                            <tr>
                                <th scope="col">Player</th>
                                <th scope="col">Score</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for score in today %}
                                <tr>
                                    <th scope="row">{{ score.user }}</th>
                                    <td>{{ score.score }}</td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% endif %}
            {% if yesterday %}
                <div class="card col-md-6 px-0 h-100">
                    <h3 class="card-header bg-success text-white">Previous Word Scores:</h3>
                    <table class="table text-center text-success">
                        <thead>
                            <tr>
                                <th scope="col">Player</th>
                                <th scope="col">Score</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for score in yesterday %}
                                <tr>
                                    <th scope="row">{{ score.user }}</th>
                                    <td>{{ score.score }}</td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% endif %}
        </div>
        <hr>
        <div class="row my-3 justify-content-around">
            <a class="btn btn-lg btn-outline-success col-md-4" href="{% url 'wordgame:scoreboard' %}">
                See Scoreboard Page
            </a>
        </div>
    </div>

{% endblock %}
